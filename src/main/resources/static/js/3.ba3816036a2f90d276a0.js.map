{"version":3,"sources":["webpack:///./node_modules/babel-runtime/core-js/get-iterator.js","webpack:///./node_modules/core-js/library/fn/get-iterator.js","webpack:///./node_modules/core-js/library/modules/core.get-iterator.js","webpack:///src/components/Im/Dialog.vue","webpack:///./src/components/Im/Dialog.vue?3789","webpack:///./src/components/Im/Dialog.vue","webpack:///src/components/Im/ChatMessage.vue","webpack:///./src/components/Im/ChatMessage.vue?11c6","webpack:///./src/components/Im/ChatMessage.vue","webpack:///src/components/Im/Chat.vue","webpack:///./src/components/Im/Chat.vue?368b","webpack:///./src/components/Im/Chat.vue","webpack:///src/pages/User/Im.vue","webpack:///./src/pages/User/Im.vue?58bb","webpack:///./src/pages/User/Im.vue"],"names":["module","exports","default","__webpack_require__","__esModule","anObject","get","getIterator","it","iterFn","TypeError","call","Dialog","name","props","active","Boolean","push","Number","online","me","info","Object","computed","recipientName","this","last_message","isSentByMe","recipient","first_name","author","last_name","recipientPhoto","photo","recipientId","id","getRecipient","statusText","moment_default","diff","lastOnlineTime","fromNow","Im_Dialog","render","_vm","_h","$createElement","_c","_self","staticClass","class","attrs","to","params","src","alt","_v","_s","_e","message_text","_f","time","staticRenderFns","components_Im_Dialog","normalizeComponent","ssrContext","ChatMessage","source","type","Im_ChatMessage","date","components_Im_ChatMessage","ChatMessage_normalizeComponent","makeHeader","msgDate","sid","stubDate","Chat","messages","Array","data","mes","itemComponent","isUserViewHistory","fetching","mounted","follow","watch","setVirtualListToBottom","messagesGrouped","groups","headerDate","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","get_iterator_default","next","done","msg","value","format","err","return","methods","extends_default","vuex_esm","onSubmitMessage","postMessage","onScrollToTop","_this","asyncToGenerator_default","regenerator_default","a","mark","_callee","oldest","wrap","_context","prev","$refs","vsl","isHistoryEndReached","loadOlderMessages","setVirtualListToOffset","$nextTick","offset","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","groupedMsg","getSize","stop","onScroll","onScrollToBottom","scrollToOffset","scrollToBottom","Im_Chat","ref","size","keeps","data-key","data-sources","data-component","wrap-class","root-tag","on","totop","&scroll","$event","tobottom","directives","rawName","expression","slot","action","submit","preventDefault","placeholder","domProps","input","target","composing","Im","components","ImDialog","ImChat","Chat_normalizeComponent","countPush","unread","checkOnlineUser","clickOnDialog","dialogId","$router","query","activeDialog","selectDialogByRoute","route","vm","switchDialog","userId","createDialogWithUser","dialogs","length","apiLoadAllDialogs","console","log","beforeRouteEnter","from","_ref","_this2","_callee2","_context2","_x","apply","arguments","beforeRouteUpdate","beforeDestroy","closeDialog","User_Im","_l","dialog","key","unread_count","last_online_time","nativeOn","click","Im_Component","Im_normalizeComponent","__webpack_exports__"],"mappings":"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","file":"js/3.ba3816036a2f90d276a0.js","sourcesContent":["module.exports = { \"default\": require(\"core-js/library/fn/get-iterator\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/get-iterator.js\n// module id = BO1k\n// module chunks = 3","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.get-iterator');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/get-iterator.js\n// module id = fxRn\n// module chunks = 3","var anObject = require('./_an-object');\nvar get = require('./core.get-iterator-method');\nmodule.exports = require('./_core').getIterator = function (it) {\n  var iterFn = get(it);\n  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/modules/core.get-iterator.js\n// module id = g8Ux\n// module chunks = 3","<template lang=\"pug\">\n  .im-dialog(:class=\"{active, push}\")\n    router-link.im-dailog__pic(:to=\"{name: 'ProfileId', params: {id: recipientId}}\")\n      img(:src=\"recipientPhoto\" :alt=\"recipientName\")\n    .im-dialog__info\n      router-link.im-dialog__name(:to=\"{name: 'ProfileId', params: {id: recipientId}}\") {{recipientName}}\n      span.user-status(:class=\"{online}\") {{statusText}}\n    .im-dialog__content\n      p.im-dialog__last\n        span.im-dialog__last-me(v-if=\"me\") Вы:\n        | {{info.last_message.message_text}}\n      span.im-dialog__time {{info.last_message.time | moment('from')}}\n    span.im-dialog__push(v-if=\"push > 0\") {{push}}\n</template>\n\n<script>\nimport moment from 'moment'\nexport default {\n  name: 'ImDialog',\n  props: {\n    active: Boolean,\n    push: Number,\n    online: Boolean,\n    me: Boolean,\n    info: Object\n  },\n  computed: {\n    recipientName() {\n      const name = this.info.last_message.isSentByMe ? this.info.last_message.recipient.first_name : this.info.last_message.author.first_name\n      const lastName = this.info.last_message.isSentByMe ? this.info.last_message.recipient.last_name : this.info.last_message.author.last_name\n      return name + ' ' + lastName\n    },\n    recipientPhoto() {\n      return this.info.last_message.isSentByMe ? this.info.last_message.recipient.photo : this.info.last_message.author.photo\n    },\n    recipientId() {\n      return this.info.last_message.isSentByMe ? this.info.last_message.recipient.id : this.info.last_message.author.id\n    },\n    getRecipient(){\n      return this.info.last_message.isSentByMe ? this.info.last_message.recipient : this.info.last_message.author\n    },\n    statusText() {\n      const recipient = this.info.last_message.isSentByMe ? this.info.last_message.recipient : this.info.last_message.author\n      return moment().diff(moment(recipient.lastOnlineTime), 'seconds') <= 60\n        ? 'Онлайн'\n        : 'был в сети ' + moment(recipient.lastOnlineTime).fromNow()\n    }\n  }\n}\n</script>\n\n<style lang=\"stylus\">\n@import '../../assets/stylus/base/vars.styl';\n\n.im-dialog {\n  display: flex;\n  align-items: center;\n  height: 100px;\n  position: relative;\n  padding: 0 6.38%;\n  z-index: 0;\n  cursor: pointer;\n\n  &:before {\n    content: '';\n    display: none;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    background-color: #F8FAFD;\n    z-index: -1;\n  }\n\n  &:after {\n    content: '';\n    display: block;\n    height: 1px;\n    width: 87.24%;\n    background-color: #E3E8EE;\n    position: absolute;\n    bottom: 0;\n    left: 50%;\n    transform: translateX(-50%);\n  }\n\n  &.push + &.active, &.active + &.push {\n    &:after {\n      display: none;\n    }\n  }\n\n  &.active {\n    &:after {\n      display: none;\n    }\n\n    &:before {\n      display: block;\n    }\n  }\n\n  &.push {\n    &:after {\n      display: none;\n    }\n\n    &:before {\n      display: block;\n      background-color: #E9F5EF;\n    }\n\n    .im-dialog__content {\n      max-width: 30%;\n    }\n\n    .im-dialog__time {\n      color: #7D9A8B;\n    }\n  }\n}\n\n.im-dailog__pic {\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  overflow: hidden;\n  margin-right: 15px;\n  flex: none;\n}\n\n.im-dialog__info {\n  width: 100%;\n  max-width: 27.11%;\n  min-width: 150px;\n  margin-right: 30px;\n\n  @media (max-width: breakpoint-xl) {\n    display: none;\n  }\n}\n\n.im-dialog__name {\n  font-size: 15px;\n  line-height: 22px;\n  color: steel-gray;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.im-dialog__content {\n  max-width: 37%;\n\n  @media (max-width: breakpoint-xl) {\n    display: none;\n  }\n}\n\n.im-dialog__last {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 13px;\n  line-height: 18px;\n  letter-spacing: -0.003em;\n\n  &-me {\n    color: eucalypt;\n  }\n}\n\n.im-dialog__time {\n  color: #A4A4B8;\n  font-size: 13px;\n  line-height: 19px;\n}\n\n.im-dialog__push {\n  width: 27px;\n  height: 27px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 15px;\n  line-height: 27px;\n  font-weight: 600;\n  color: #fff;\n  background-color: #E65151;\n  margin-left: auto;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Im/Dialog.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"im-dialog\",class:{active: _vm.active, push: _vm.push}},[_c('router-link',{staticClass:\"im-dailog__pic\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.recipientId}}}},[_c('img',{attrs:{\"src\":_vm.recipientPhoto,\"alt\":_vm.recipientName}})]),_c('div',{staticClass:\"im-dialog__info\"},[_c('router-link',{staticClass:\"im-dialog__name\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.recipientId}}}},[_vm._v(_vm._s(_vm.recipientName))]),_c('span',{staticClass:\"user-status\",class:{online: _vm.online}},[_vm._v(_vm._s(_vm.statusText))])],1),_c('div',{staticClass:\"im-dialog__content\"},[_c('p',{staticClass:\"im-dialog__last\"},[(_vm.me)?_c('span',{staticClass:\"im-dialog__last-me\"},[_vm._v(\"Вы:\")]):_vm._e(),_vm._v(_vm._s(_vm.info.last_message.message_text))]),_c('span',{staticClass:\"im-dialog__time\"},[_vm._v(_vm._s(_vm._f(\"moment\")(_vm.info.last_message.time,'from')))])]),(_vm.push > 0)?_c('span',{staticClass:\"im-dialog__push\"},[_vm._v(_vm._s(_vm.push))]):_vm._e()],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-c0ad20e8\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Im/Dialog.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-c0ad20e8\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Dialog.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Dialog.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Dialog.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-c0ad20e8\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Dialog.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Im/Dialog.vue\n// module id = null\n// module chunks = ","<template lang=\"pug\">\n  // Please avoid to use margin between messages block\n  // or it will glitter on scroll\n  h5.im-chat__message-title(v-if='source.stubDate') {{source.date | moment('DD MMMM YYYY')}}\n  .im-chat__message-block(v-else :class=\"{me: source.isSentByMe}\")\n      p.im-chat__message-text {{source.message_text}}\n      span.im-chat__message-time {{source.time | moment('YYYY-MM-DD hh:mm')}}\n</template>\n\n<script>\nimport moment from 'moment'\n\nexport default {\n  name: 'infinite-loading-item',\n  props: {\n    source: {\n      type: Object,\n      default() {\n        return {}\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n@import '../../assets/stylus/base/vars.styl';\n\n\n.im-chat__message-day {\n  &+& {\n    margin-top: 50px;\n  }\n}\n\n.im-chat__message-title {\n  color: #8A94A4;\n  font-size: 15px;\n  text-align: center;\n  display: block;\n  width: 100%;\n}\n\n.im-chat__message-block {\n  display: flex;\n  align-items: center;\n  max-width: 460px;\n\n  &+& {\n    margin-top: 20px;\n  }\n\n  &.me + & {\n    margin-top: 30px;\n  }\n\n  &.me {\n    flex-direction: row-reverse;\n    max-width: 450px;\n    margin-left: auto;\n\n    .im-chat__message-text {\n      background-color: eucalypt;\n      color: #fff;\n      box-shadow: 0px 4px 15px #D4E8DD;\n    }\n\n    .im-chat__message-time {\n      margin-right: 15px;\n      margin-left: 0;\n    }\n  }\n}\n\n.im-chat__message-text {\n  background-color: #FFFFFF;\n  box-shadow: 0px 4px 15px #EFF1F6;\n  border-radius: 20px;\n  padding: 15px 20px;\n  color: steel-gray;\n  font-size: 15px;\n  line-height: 23px;\n}\n\n.im-chat__message-time {\n  font-size: 13px;\n  color: #BAC3D0;\n  margin-left: 15px;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Im/ChatMessage.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.source.stubDate)?_c('h5',{staticClass:\"im-chat__message-title\"},[_vm._v(_vm._s(_vm._f(\"moment\")(_vm.source.date,'DD MMMM YYYY')))]):_c('div',{staticClass:\"im-chat__message-block\",class:{me: _vm.source.isSentByMe}},[_c('p',{staticClass:\"im-chat__message-text\"},[_vm._v(_vm._s(_vm.source.message_text))]),_c('span',{staticClass:\"im-chat__message-time\"},[_vm._v(_vm._s(_vm._f(\"moment\")(_vm.source.time,'YYYY-MM-DD hh:mm')))])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-1e46ed34\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Im/ChatMessage.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-1e46ed34\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ChatMessage.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ChatMessage.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ChatMessage.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-1e46ed34\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./ChatMessage.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-1e46ed34\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Im/ChatMessage.vue\n// module id = null\n// module chunks = ","<template lang=\"pug\">\n  .im-chat\n    .im-chat__user\n      router-link.im-chat__user-pic(:to=\"{name: 'ProfileId', params: {id: recipientId}}\")\n        img(:src= \"recipientPhoto\" :alt= \"recipientName\")\n      router-link.im-chat__user-name(:to=\"{name: 'ProfileId', params: {id: recipientId}}\") {{recipientName}}\n      span.user-status(:class=\"{online}\") {{statusText}}\n    .im-chat__infitite_list_wrapper\n      virtual-list.im-chat__infitite_list.scroll-touch(:size=\"60\"\n        :keeps=\"120\"\n        :data-key=\"'sid'\"\n        :data-sources=\"messagesGrouped\"\n        :data-component=\"itemComponent\"\n        :wrap-class=\"'im-chat__message'\"\n        :root-tag=\"'section'\"\n        @totop=\"onScrollToTop\"\n        @scroll.passive=\"onScroll\"\n        @tobottom=\"onScrollToBottom\"\n        ref=\"vsl\"\n      )\n        .im-chat__loader(slot=\"header\", v-show=\"fetching\")\n          .spinner(v-show=\"!isHistoryEndReached()\")\n          .finished(v-show=\"isHistoryEndReached()\") Больше сообщений нет\n    form.im-chat__enter(action=\"#\" @submit.prevent=\"onSubmitMessage\")\n      input.im-chat__enter-input(type=\"text\" placeholder=\"Ваше сообщение...\" v-model=\"mes\")\n</template>\n\n<script>\nimport moment from 'moment'\nimport Vue from 'vue'\nimport { mapActions, mapGetters } from 'vuex'\nimport ChatMessage from '@/components/Im/ChatMessage'\nimport VirtualList from 'vue-virtual-scroll-list'\n\nconst makeHeader = msgDate => {\n  return { sid: `group-${msgDate}`, stubDate: true, date: msgDate }\n}\nexport default {\n  name: 'ImChat',\n  props: {\n    info: Object,\n    messages: Array,\n    online: Boolean\n  },\n  data: () => ({\n    mes: '',\n    itemComponent: ChatMessage,\n    isUserViewHistory: false,\n    fetching: false\n  }),\n  mounted() {\n    this.follow = true\n  },\n  watch: {\n    messages() {\n      if (this.follow) this.setVirtualListToBottom()\n    }\n  },\n  computed: {\n    recipientName() {\n      const name = this.info.last_message.isSentByMe ? this.info.last_message.recipient.first_name : this.info.last_message.author.first_name\n      const lastName = this.info.last_message.isSentByMe ? this.info.last_message.recipient.last_name : this.info.last_message.author.last_name\n      return name + ' ' + lastName\n    },\n    recipientPhoto() {\n      return this.info.last_message.isSentByMe ? this.info.last_message.recipient.photo : this.info.last_message.author.photo\n    },\n    recipientId() {\n      return this.info.last_message.isSentByMe ? this.info.last_message.recipient.id : this.info.last_message.author.id\n    },\n    getRecipient(){\n      return this.info.last_message.isSentByMe ? this.info.last_message.recipient : this.info.last_message.author\n    },\n    statusText() {\n      const recipient = this.info.last_message.isSentByMe ? this.info.last_message.recipient : this.info.last_message.author\n      return moment().diff(moment(recipient.lastOnlineTime), 'seconds') <= 60\n        ? 'Онлайн'\n        : 'был в сети ' + moment(recipient.lastOnlineTime).fromNow()\n    },\n    messagesGrouped() {\n      let groups = []\n      let headerDate = null\n\n      for (const msg of this.messages) {\n        let msgDate = moment(msg.time).format('YYYY-MM-DD')\n        if (msgDate !== headerDate) {\n          headerDate = msgDate\n          groups.push(makeHeader(headerDate))\n        }\n        groups.push(msg)\n      }\n      return groups\n    }\n  },\n  methods: {\n    ...mapActions('profile/dialogs', ['postMessage', 'loadOlderMessages']),\n    ...mapGetters('profile/dialogs', ['isHistoryEndReached']),\n    onSubmitMessage() {\n      this.postMessage({ id: this.info.id, message_text: this.mes })\n      this.mes = ''\n    },\n    async onScrollToTop() {\n      if (this.$refs.vsl) {\n        if (!this.isHistoryEndReached()) {\n          let oldest = this.messagesGrouped[0]\n\n          this.fetching = true\n          await this.loadOlderMessages()\n          this.setVirtualListToOffset(1)\n\n          this.$nextTick(() => {\n            let offset = 0\n            for (const groupedMsg of this.messagesGrouped) {\n              if (groupedMsg.sid === oldest.sid) break\n              offset += this.$refs.vsl.getSize(groupedMsg.sid)\n            }\n\n            this.setVirtualListToOffset(offset)\n            this.fetching = false\n          })\n        }\n      }\n    },\n    onScroll() {\n      this.follow = false\n    },\n    onScrollToBottom() {\n      this.follow = true\n    },\n    setVirtualListToOffset(offset) {\n      if (this.$refs.vsl) {\n        this.$refs.vsl.scrollToOffset(offset)\n      }\n    },\n    setVirtualListToBottom() {\n      if (this.$refs.vsl) {\n        this.$refs.vsl.scrollToBottom()\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"stylus\">\n@import '../../assets/stylus/base/vars.styl';\n\n.im-chat {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n\n.im-chat__user {\n  border-bottom: 1px solid #E3E8EE;\n  display: flex;\n  align-items: center;\n  height: 60px;\n  padding: 30px 20px;\n  font-size: 13px;\n  background-color: #F8FAFD;\n}\n\n.im-chat__user-pic {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  overflow: hidden;\n  margin-right: 10px;\n}\n\n.im-chat__user-name {\n  font-weight: 600;\n  color: steel-gray;\n  margin-right: auto;\n}\n\n.im-chat__user-status {\n  color: #9EA4AD;\n\n  &.online {\n    color: eucalypt;\n  }\n}\n\n.im-chat__infitite_list_wrapper {\n  position: relative;\n  flex: 1;\n}\n\n.im-chat__infitite_list {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  overflow-y: auto;\n}\n\n.im-chat__message > div {\n  padding-left: 30px;\n  padding-right: 30px;\n  padding: 20px;\n}\n\n.im-chat__enter {\n  display: block;\n  width: 100%;\n}\n\n.im-chat__enter-input {\n  width: 100%;\n  background-color: #fff;\n  padding: 0 40px;\n  font-size: 15px;\n  color: steel-gray;\n  height: 60px;\n\n  &::placeholder {\n    color: #B0B0BC;\n  }\n}\n\n\n.im-chat__loader {\n  padding: 1em;\n  .finished {\n    font-size: 14px;\n    text-align: center;\n    color: #bfbfbf;\n  }\n  .spinner {\n    font-size: 10px;\n    margin: 0px auto;\n    text-indent: -9999em;\n    width: 25px;\n    height: 25px;\n    border-radius: 50%;\n    background: #ffffff;\n    background: linear-gradient(to right, eucalypt 10%, rgba(255, 255, 255, 0) 42%);\n    position: relative;\n    animation: load3 1.4s infinite linear;\n    transform: translateZ(0);\n  }\n  .spinner:before {\n    width: 50%;\n    height: 50%;\n    background: eucalypt;\n    border-radius: 100% 0 0 0;\n    position: absolute;\n    top: 0;\n    left: 0;\n    content: '';\n  }\n  .spinner:after {\n    background: #f8fafd;\n    width: 75%;\n    height: 75%;\n    border-radius: 50%;\n    content: '';\n    margin: auto;\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n  }\n  @-webkit-keyframes load3 {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n  @keyframes load3 {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Im/Chat.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"im-chat\"},[_c('div',{staticClass:\"im-chat__user\"},[_c('router-link',{staticClass:\"im-chat__user-pic\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.recipientId}}}},[_c('img',{attrs:{\"src\":_vm.recipientPhoto,\"alt\":_vm.recipientName}})]),_c('router-link',{staticClass:\"im-chat__user-name\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.recipientId}}}},[_vm._v(_vm._s(_vm.recipientName))]),_c('span',{staticClass:\"user-status\",class:{online: _vm.online}},[_vm._v(_vm._s(_vm.statusText))])],1),_c('div',{staticClass:\"im-chat__infitite_list_wrapper\"},[_c('virtual-list',{ref:\"vsl\",staticClass:\"im-chat__infitite_list scroll-touch\",attrs:{\"size\":60,\"keeps\":120,\"data-key\":'sid',\"data-sources\":_vm.messagesGrouped,\"data-component\":_vm.itemComponent,\"wrap-class\":'im-chat__message',\"root-tag\":'section'},on:{\"totop\":_vm.onScrollToTop,\"&scroll\":function($event){return _vm.onScroll($event)},\"tobottom\":_vm.onScrollToBottom}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.fetching),expression:\"fetching\"}],staticClass:\"im-chat__loader\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.isHistoryEndReached()),expression:\"!isHistoryEndReached()\"}],staticClass:\"spinner\"}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isHistoryEndReached()),expression:\"isHistoryEndReached()\"}],staticClass:\"finished\"},[_vm._v(\"Больше сообщений нет\")])])])],1),_c('form',{staticClass:\"im-chat__enter\",attrs:{\"action\":\"#\"},on:{\"submit\":function($event){$event.preventDefault();return _vm.onSubmitMessage($event)}}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.mes),expression:\"mes\"}],staticClass:\"im-chat__enter-input\",attrs:{\"type\":\"text\",\"placeholder\":\"Ваше сообщение...\"},domProps:{\"value\":(_vm.mes)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.mes=$event.target.value}}})])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-277cdb10\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Im/Chat.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-277cdb10\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Chat.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Chat.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Chat.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-277cdb10\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Chat.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Im/Chat.vue\n// module id = null\n// module chunks = ","<template lang=\"pug\">\n  .im\n    .im__dialogs\n      im-dialog(v-for=\"dialog in dialogs\"\n      :key=\"dialog.id\"\n      :info=\"dialog\"\n      :push=\"countPush(dialog.unread_count)\"\n      :me=\"dialog.last_message.isSentByMe\"\n      :active=\"activeDialog && dialog.id === activeDialog.id\"\n      :online=\"checkOnlineUser(dialog.last_message.recipient.last_online_time)\"\n      @click.native=\"clickOnDialog(dialog.id)\")\n    .im__chat(v-if=\"activeDialog\")\n      im-chat(:info=\"activeDialog\" :messages=\"messages\"\n      :online=\"checkOnlineUser(activeDialog.last_message.recipient.last_online_time)\" )\n</template>\n\n<script>\nimport moment from 'moment'\nimport { mapGetters, mapActions } from 'vuex'\nimport ImDialog from '@/components/Im/Dialog'\nimport ImChat from '@/components/Im/Chat'\nexport default {\n  name: 'Im',\n  components: { ImDialog, ImChat },\n  // data: () => ({\n  //   intervalForMessages: null\n  // }),\n  computed: {\n    ...mapGetters('profile/dialogs', ['messages', 'activeDialog', 'dialogs'])\n  },\n  methods: {\n    ...mapActions('profile/dialogs', [\n      'loadFreshMessages',\n      'switchDialog',\n      'closeDialog',\n      'createDialogWithUser',\n      'apiLoadAllDialogs'\n    ]),\n    countPush(unread) {\n      return unread > 0 ? unread : null\n    },\n    checkOnlineUser(time) {\n      return moment().diff(moment(time), 'seconds') <= 60\n    },\n    clickOnDialog(dialogId) {\n      this.$router.push({ name: 'Im', query: { activeDialog: dialogId } })\n    },\n    async selectDialogByRoute(route, vm) {\n      if (route.query.activeDialog) {\n        vm.switchDialog(route.query.activeDialog)\n      } else if (route.query.userId) {\n        vm.createDialogWithUser(route.query.userId)\n      } else if (vm.dialogs.length > 0) {\n        vm.$router.push({ name: 'Im', query: { activeDialog: vm.dialogs[0].id } })\n      } else {\n        await vm.apiLoadAllDialogs()\n        if (vm.dialogs.length > 0) {\n          vm.$router.push({ name: 'Im', query: { activeDialog: vm.dialogs[0].id } })\n        }\n        console.log('No dialogs at all')\n      }\n    }\n  },\n  beforeRouteEnter(to, from, next) {\n    next(async vm => {\n      vm.selectDialogByRoute(to, vm)\n    })\n  },\n  beforeRouteUpdate(to, from, next) {\n    this.selectDialogByRoute(to, this)\n    next()\n  },\n  beforeDestroy() {\n    this.closeDialog()\n  }\n}\n</script>\n\n<style lang=\"stylus\">\n@import '../../assets/stylus/base/vars.styl';\n\n.im {\n  display: flex;\n  height: 'calc(100vh - %s)' % header-height;\n}\n\n.im__dialogs {\n  width: 100%;\n  max-width: 39.13%;\n  overflow-y: auto;\n  max-height: 100%;\n  height: 100%;\n  background-color: #F2F5F9;\n\n  @media (max-width: breakpoint-xl) {\n    max-width: 120px;\n  }\n}\n\n.im__chat {\n  width: 100%;\n  flex: auto;\n  height: 100%;\n  background-color: #F8FAFD;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/pages/User/Im.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"im\"},[_c('div',{staticClass:\"im__dialogs\"},_vm._l((_vm.dialogs),function(dialog){return _c('im-dialog',{key:dialog.id,attrs:{\"info\":dialog,\"push\":_vm.countPush(dialog.unread_count),\"me\":dialog.last_message.isSentByMe,\"active\":_vm.activeDialog && dialog.id === _vm.activeDialog.id,\"online\":_vm.checkOnlineUser(dialog.last_message.recipient.last_online_time)},nativeOn:{\"click\":function($event){return _vm.clickOnDialog(dialog.id)}}})}),1),(_vm.activeDialog)?_c('div',{staticClass:\"im__chat\"},[_c('im-chat',{attrs:{\"info\":_vm.activeDialog,\"messages\":_vm.messages,\"online\":_vm.checkOnlineUser(_vm.activeDialog.last_message.recipient.last_online_time)}})],1):_vm._e()])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-3b23352c\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/User/Im.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-3b23352c\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Im.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Im.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Im.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3b23352c\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Im.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/User/Im.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}